<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
</head>

<body style="zoom: 1.5">
  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D1')">Rain mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  Color: <select data-label="E" onchange="sendCommand('E'+this.value)">
    <option value="0">Fixed</option>
    <option value="1">Orangish</option>
    <option value="2">Random orangish</option>
    <option value="3">Geenish</option>
    <option value="4">Random greenish</option>
    <option value="5">Violetish</option>
    <option value="6">Random violetish</option>
    <option value="7">Rainbow</option>
    <option value="8">Random rainbow</option>
    <option value="9">Random</option>
  </select><br>
  If color is fixed:<br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  If not fixed:<br>
  Color change speed: <input data-label="F" type="range" oninput="sendSlowlyCommand('F'+this.value)" min="0"
    max="10"></input><br>
  Fading speed: <input data-label="G" type="range" oninput="sendSlowlyCommand('G'+this.value)" min="0"
    max="9"></input><br>
  Other options:<br>
  Number of events: <input data-label="B" type="range" oninput="sendSlowlyCommand('B'+this.value)" min="0"
    max="7"></input><br>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D3')">Comet mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  Color: <select data-label="E" onchange="sendCommand('E'+this.value)">
    <option value="0">Fixed</option>
    <option value="1">Orangish</option>
    <option value="2">Random orangish</option>
    <option value="3">Geenish</option>
    <option value="4">Random greenish</option>
    <option value="5">Violetish</option>
    <option value="6">Random violetish</option>
    <option value="7">Rainbow</option>
    <option value="8">Random rainbow</option>
    <option value="9">Random</option>
  </select><br>
  If color is fixed:<br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  <!--
  Red: <input data-label="K" type="range" oninput="sendSlowlyCommand('K'+value)" min="0" max="255"></input><br>
  Green: <input data-label="L" type="range" oninput="sendSlowlyCommand('L'+this.value)" min="0" max="255"></input><br>
  Blue: <input data-label="M" type="range" oninput="sendSlowlyCommand('M'+this.value)" min="0" max="255"></input><br>
  -->
  If not fixed:<br>
  Color change speed: <input data-label="F" type="range" oninput="sendSlowlyCommand('F'+this.value)" min="0"
    max="10"></input><br>
  Fading speed: <input data-label="G" type="range" oninput="sendSlowlyCommand('G'+this.value)" min="0"
    max="9"></input><br>
  Other options:<br>
  Speed: <input data-label="C" type="range" oninput="sendSlowlyCommand('C'+this.value)" min="0" max="20"></input><br>
  Number of events: <input data-label="B" type="range" oninput="sendSlowlyCommand('B'+this.value)" min="0"
    max="7"></input><br>
  Direction: <select data-label="O" onchange="sendCommand('O'+this.value)">
    <option value="1">From left to right</option>
    <option value="2">From right to left</option>
    <option value="3">From top to bottom</option>
    <option value="4">From bottom to top</option>
    <option value="5">Horizontal</option>
    <option value="6">Vertical</option>
    <option value="7">Any</option>
  </select><br>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D4')">Wave mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  Color: <select data-label="E" onchange="sendCommand('E'+this.value)">
    <option value="0">Fixed</option>
    <option value="1">Orangish</option>
    <option value="2">Random orangish</option>
    <option value="3">Geenish</option>
    <option value="4">Random greenish</option>
    <option value="5">Violetish</option>
    <option value="6">Random violetish</option>
    <option value="7">Rainbow</option>
    <option value="8">Random rainbow</option>
    <option value="9">Random</option>
  </select><br>

  If color is fixed:<br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  If not fixed:<br>
  Color change speed: <input data-label="F" type="range" oninput="sendSlowlyCommand('F'+this.value)" min="0"
    max="10"></input><br>
  Other options:<br>
  Speed: <input data-label="C" type="range" oninput="sendSlowlyCommand('C'+this.value)" min="0" max="20"></input><br>
  Direction: <select data-label="O" onchange="sendCommand('O'+this.value)">
    <option value="1">From left to right</option>
    <option value="2">From right to left</option>
    <option value="3">From top to bottom</option>
    <option value="4">From bottom to top</option>
  </select><br>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D8')">Flame mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  Color: <select data-label="E" onchange="sendCommand('E'+this.value)">
    <option value="0">Fixed</option>
    <option value="1">Orangish</option>
    <option value="2">Random orangish</option>
    <option value="3">Geenish</option>
    <option value="4">Random greenish</option>
    <option value="5">Violetish</option>
    <option value="6">Random violetish</option>
    <option value="7">Rainbow</option>
    <option value="8">Random rainbow</option>
    <option value="9">Random</option>
  </select><br>
  If color is fixed:<br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  If not fixed:<br>
  Color change speed: <input data-label="F" type="range" oninput="sendSlowlyCommand('F'+this.value)" min="0"
    max="10"></input><br>
  Other options:<br>
  Number of events: <input data-label="B" type="range" oninput="sendSlowlyCommand('B'+this.value)" min="0"
    max="7"></input><br>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D2')">RGB mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  <!--
  Red: <input data-label="K" type="range" oninput="sendSlowlyCommand('K'+value)" min="0" max="255"></input><br>
  Green: <input data-label="L" type="range" oninput="sendSlowlyCommand('L'+this.value)" min="0" max="255"></input><br>
  Blue: <input data-label="M" type="range" oninput="sendSlowlyCommand('M'+this.value)" min="0" max="255"></input><br>
  -->
  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D0')">Function mode</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  <input type="radio" name="N" data-label="N" value="0" onclick="sendCommand('N0')"><label>Blue / Red</label>
  <input type="radio" name="N" data-label="N" value="1" onclick="sendCommand('N1')"><label>HSL</label><br>
  <textarea class="border-2 border-black" id="functionStr" name="functionStr" cols="40"
    rows="4">sin(t-sqrt((x-3.5)^2+(y-3.5)^2))</textarea>
  <button class="border-2 border-black" onmousedown="sendFunction()">Submit function</button><br>
  <button class="border-2 border-black" onmousedown="demoFunction('sin(t-sqrt((x-3.5)^2+(y-3.5)^2))')">
    Demo 1
  </button>
  <button class="border-2 border-black" onmousedown="demoFunction('1/32*tan(t/64*x*tan(i-x))')">Demo 2</button>
  <button class="border-2 border-black" onmousedown="demoFunction('(x-5)^2 + (y-5)^2 - 99*sin(t)')">
    Demo 3
  </button>
  <button class="border-2 border-black" onmousedown="demoFunction('sin(t-sqrt(x^2+y^2))')">Demo 4</button><br>
  <button class="border-2 border-black" onmousedown="demoFunction('floor(t)*60')">Demo HSV 1</button>
  <button class="border-2 border-black" onmousedown="demoFunction('t*60')">Demo HSV 2</button>
  <button class="border-2 border-black" onmousedown="demoFunction('(sin(t/4-sqrt((x-3.5)^2+(y-3.5)^2))+1)*30+240')">Demo
    HSV 3</button>

    <a href="https://tixy.land/" target="_blank">Test your function here</a>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D5')">Meteo</button>
  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>


  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D6')">Snake</button>

  <button class="border-2 border-black" onmousedown="sendCommand('T1')">1 player</button>
  <button class="border-2 border-black" onmousedown="sendCommand('T2')">2 players</button>
  <button class="border-2 border-black" onmousedown="sendCommand('T3')">3 players</button>
  <button class="border-2 border-black" onmousedown="sendCommand('T4')">4 players</button>
  <div class="h-12"></div>

  <div class="select-none text-xxl text-white text-center grid gap-3 grid-cols-3 font-color">

    <div class="h-12 col-span-3 bg-red-500" ontouchstart="event.preventDefault(); sendCommand('P3')" onmousedown="sendCommand('P3')">Top</div>   
    <div class="h-12 bg-red-500" ontouchstart="event.preventDefault(); sendCommand('P1')" onmousedown="sendCommand('P1')">Left
    </div>
    <div class="bg-white"></div>
    <div class="h-12 bg-red-500" ontouchstart="event.preventDefault(); sendCommand('P2')" onmousedown="sendCommand('P2')">Right
    </div>

    <div class="h-12 col-span-3 bg-red-500" ontouchstart="event.preventDefault(); sendCommand('P4')" onmousedown="sendCommand('P4')">Bottom
    </div>
  </div>
  <div class="h-24"></div>
  <div class="select-none text-xxl text-white text-center bg-blue-500 grid gap-2 grid-cols-3 font-color">
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('Q3')" onmousedown="sendCommand('Q3')">Top</div>
    <div class="bg-white"></div>

    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('Q1')" onmousedown="sendCommand('Q1')">Left
    </div>
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('Q2')" onmousedown="sendCommand('Q2')">Right
    </div>

    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('Q4')" onmousedown="sendCommand('Q4')">Bottom
    </div>
    <div class="bg-white"></div>
  </div>

  <div class="h-24"></div>
  <div class="select-none text-xxl text-white text-center bg-green-500 grid gap-2 grid-cols-3 font-color">
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('R3')" onmousedown="sendCommand('R3')">Top</div>
    <div class="bg-white"></div>

    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('R1')" onmousedown="sendCommand('R1')">Left
    </div>
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('R2')" onmousedown="sendCommand('R2')">Right
    </div>

    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('R4')" onmousedown="sendCommand('R4')">Bottom
    </div>
    <div class="bg-white"></div>
  </div>

  <div class="h-24"></div>
  <div class="select-none text-xxl text-white text-center bg-purple-500 grid gap-2 grid-cols-3 font-color">
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('S3')" onmousedown="sendCommand('S3')">Top</div>
    <div class="bg-white"></div>

    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('S1')" onmousedown="sendCommand('S1')">Left
    </div>
    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('S2')" onmousedown="sendCommand('S2')">Right
    </div>

    <div class="bg-white"></div>
    <div class="h-12" ontouchstart="event.preventDefault(); sendCommand('S4')" onmousedown="sendCommand('S4')">Bottom
    </div>
    <div class="bg-white"></div>
  </div>

  <div class="h-12"></div>

  <button class="text-2xl bg-blue-600 w-full text-white" onmousedown="sendCommand('D7')">Life</button>
  <button class="border-2 border-black" onmousedown="sendCommand('P-1,0')">Random seed</button>

  Demo: <select data-label="P" onchange="sendCommand('P-1,'+this.value)">
    <option value="150">150 (infinite)</option>
    <option value="177">177 (33)</option>
    <option value="177">183 (514)</option>
    <option value="613">613 (sympa)</option>
    <option value="685">685 (677)</option>
    <option value="692">692 (infinite)</option>
    <option value="843">843 (254)</option>
    <option value="1850">1850 (infinite)</option>
    <option value="2424">2424 (273)</option>
    <option value="2793">2793 (infinite)</option>
    <option value="3589">3589 (318)</option>
    <option value="3622">3622 (multimove)</option>
    <option value="3791">3791 (infinite)</option>
    <option value="4026">4026 (infinite)</option>
    <option value="4026">4026 (infinite)</option>
    <option value="4043">4043 (nice)</option>
    <option value="4044">4044 (infinite)</option>
    <option value="4059">4059 (check over 50)</option>
    <option value="4072">4072 (check over 50)</option>
    <option value="4072">4426 (752)</option>

    <option value="8491">8491 (658)</option>
    <option value="9944">9944 (inf)</option>
    <option value="9995">9995 ()</option>
    <option value="9308">9308 (706)</option>
    <option value="10045">10045 (inf)</option>
    <option value="10130">10130 (fun)</option>
    <option value="10440">10440 (fun)</option>
    <option value="12357">12357 (350)</option>
    <option value="20183">20183 (760)</option>
    <option value="20701">20701 (Spaceship !)</option>
    <option value="20183">23161 (800)</option>
    
    <option value="25725">25725 (472)</option>
    <option value="28932">28932 (108, cool)</option>
    <option value="40774">40774 (369)</option>
    <option value="48880">48880 (447)</option>
    <option value="49693">49693 (384)</option>
    <option value="50628">50628 (243)</option>
    <option value="56501">56501 Best (632)</option>

  </select><br>

  <form>
     Seed<input data-label="P" type="number" class="border-2 border-black" name="seed" min="0" max="65535" value="0">
    <input type="submit" onclick="event.preventDefault(); sendCommand('P-1,'+this.form.seed.value);">
  </form>
  <button class="border-2 border-black" onmousedown="reloadSettings()">Get current settings</button><br>
  Current: <input data-label="R" type="text" readonly> - Previous: <input data-label="S" type="text" readonly><br>

  Brightness: <input data-label="A" type="range" oninput="sendSlowlyCommand('A'+value)" min="0" max="255"></input><br>
  Speed: <input data-label="C" type="range" oninput="sendSlowlyCommand('C'+this.value)" min="0" max="20"></input><br>
  Color: <select data-label="E" onchange="sendCommand('E'+this.value)">
    <option value="0">Fixed</option>
    <option value="1">Orangish</option>
    <option value="2">Random orangish</option>
    <option value="3">Geenish</option>
    <option value="4">Random greenish</option>
    <option value="5">Violetish</option>
    <option value="6">Random violetish</option>
    <option value="7">Rainbow</option>
    <option value="8">Random rainbow</option>
    <option value="9">Random</option>
  </select><br>
  If color is fixed:<br>
  <input type="color" data-label="KLM"
    oninput="sendSlowlyCommand('K'+value.match(/[A-Za-z0-9]{2}/g).map(v => parseInt(v, 16)).join(','))"></input><br>
  Color change speed: <input data-label="F" type="range" oninput="sendSlowlyCommand('F'+this.value)" min="0"
    max="10"></input><br>

  <h1>Control and settings</h1>
  Nb rows: <input data-label="I" type="number" oninput="sendCommand('I'+value)" min="0" max="255"></input><br>
  Nb led per rows: <input data-label="J" type="number" oninput="sendCommand('J'+value)" min="0" max="255"></input><br>
  <button class="border-2 border-black" onmousedown="sendCommand('h')">Help</button>
  <button class="border-2 border-black" onmousedown="sendCommand('s')">Settings</button>
  <h1>Advanced</h1>
  <form>
    <input type="text" class="border-2 border-black" name="command"> <input type="submit"
      onclick="event.preventDefault(); sendCommand(this.form.command.value);">
  </form>

  <textarea class="border-2 border-black" id="result" rows="10" cols="40"> </textarea>
  <script>
//    const server = "http://cube4.local/";
    const server = "/";
    let timerId = undefined;
    let lastEvent = Date.now();
    let throttle = 200;
    async function sendSlowlyCommand(command) {
      clearTimeout(timerId);
      if ((Date.now() - lastEvent) > throttle) {
        lastEvent = Date.now();
        sendCommand(command);
      } else {
        timerId = setTimeout(() => {
          lastEvent = Date.now();
          sendCommand(command);
        }, throttle - (Date.now() - lastEvent));
      }
    }
    async function sendCommand(command) {
      console.log(command);
      if (command.match(/^[A-Z][0-9]+$/)) {
        let elements = document.querySelectorAll(`[data-label=${command.substring(0, 1)}]`);
        for (let element of elements) {
          element.value = command.substring(1);
        }
      }

      const response = await fetch(
        server + "command" + "?value=" + encodeURIComponent(command)
      );
      const result = await response.text();
      document.getElementById("result").value = result;
      return result;
    }
    async function demoFunction(functionStr) {
      document.getElementById("functionStr").value = functionStr;
      sendFunction();
    }
    async function sendFunction() {
      const functionStr = document.getElementById("functionStr").value;
      console.log(functionStr);
      const response = await fetch(
        server + "function" + "?value=" + encodeURIComponent(functionStr)
      );
      const result = await response.text();
      document.getElementById("result").value = result;
    }
    async function reloadSettings() {
      let result = await sendCommand('uc');
      // TODO we could check the checkDigit ...
      for (let i = 0; i < Math.min(result.length, 104); i = i + 4) {
        let code = String.fromCharCode(65 + i / 4);
        let value = parseInt(result.substring(i, i + 4), 16);
        let elements = document.querySelectorAll(`[data-label="${code}"]:not([type="radio"])`);
        for (let element of elements) {
          element.value = value;
        }
        // radio button
        elements = document.querySelectorAll(`[data-label="${code}"][value="${value}"]`);
        for (let element of elements) {
          element.setAttribute('checked', 'checked');
        }
      }
      // color button (in KLM)
      let elements = document.querySelectorAll(`[data-label="KLM"]`);
      for (let element of elements) {
        element.value = "#" + result.substr(42, 2) + result.substr(46, 2) + result.substr(50, 2);
        console.log(element.value);
      }
      console.log(result);
    }
    reloadSettings();
  </script>
</body>

</html>